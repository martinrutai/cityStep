{"ast":null,"code":"var _jsxFileName = \"/Users/daliborseckar/cityStep/src/components/map.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n  iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'\n});\nfunction Map() {\n  _s();\n  const mapContainerRef = useRef(null);\n  const mapInstanceRef = useRef(null);\n  useEffect(() => {\n    if (mapContainerRef.current && !mapInstanceRef.current) {\n      const map = L.map(mapContainerRef.current).setView([51.505, -0.09], 13);\n      mapInstanceRef.current = map;\n      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        maxZoom: 19,\n        attribution: '© OpenStreetMap contributors'\n      }).addTo(map);\n      map.on('contextmenu', function (e) {\n        L.DomEvent.preventDefault(e);\n        const latlng = e.latlng;\n        const popup = L.popup(); // Define 'popup' before the handler\n\n        const confirmLocationHandler = () => {\n          // map.closePopup(); // ❌ Removed: It triggers the 'remove' cleanup before the listener can execute the rest of its code.\n\n          L.marker(latlng).addTo(map).bindPopup(\"New Marker Added at: \" + latlng.lat.toFixed(4) + \", \" + latlng.lng.toFixed(4)).openPopup();\n\n          // ✅ Now close the context menu popup. This will trigger the 'remove' cleanup, \n          // but the marker is already added and the new popup is open.\n          if (popup.isOpen()) {\n            popup.remove();\n          }\n        };\n        const popupContent = `\n                    <div style=\"text-align: center; padding: 5px;\">\n                        <p style=\"font-weight: 600; margin-bottom: 10px;\">Add a new location marker here?</p>\n                        <button id=\"add-marker-btn\" \n                                style=\"padding: 8px 15px; cursor: pointer; background-color: #0078A8; color: white; border: none; border-radius: 4px; font-size: 14px; transition: background-color 0.2s;\">\n                            Confirm Location\n                        </button>\n                    </div>\n                `;\n        popup.setLatLng(latlng).setContent(popupContent).openOn(map); // Open the context menu popup\n\n        popup.on('open', function () {\n          const button = document.getElementById('add-marker-btn');\n          if (button) {\n            L.DomEvent.on(button, 'click', confirmLocationHandler);\n            popup.buttonClickHandler = confirmLocationHandler; // Store reference for cleanup\n          }\n        });\n        popup.on('remove', function () {\n          // This cleanup is good and necessary to prevent memory leaks!\n          const button = document.getElementById('add-marker-btn');\n          if (button && popup.buttonClickHandler) {\n            L.DomEvent.off(button, 'click', popup.buttonClickHandler);\n            popup.buttonClickHandler = null;\n          }\n        });\n      });\n      return () => {\n        map.remove();\n        mapInstanceRef.current = null;\n      };\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '20px',\n      backgroundColor: '#f4f7f9',\n      minHeight: '100vh'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapContainerRef,\n      id: \"map\",\n      style: {\n        height: '70vh',\n        width: '100%',\n        borderRadius: '8px',\n        boxShadow: '0 4px 12px rgba(0,0,0,0.1)'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 9\n  }, this);\n}\n_s(Map, \"KLmHBsvVmnsss9T0YDVbP1TBwkM=\");\n_c = Map;\nexport default Map;\nvar _c;\n$RefreshReg$(_c, \"Map\");","map":{"version":3,"names":["React","useEffect","useRef","L","jsxDEV","_jsxDEV","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","Map","_s","mapContainerRef","mapInstanceRef","current","map","setView","tileLayer","maxZoom","attribution","addTo","on","e","DomEvent","preventDefault","latlng","popup","confirmLocationHandler","marker","bindPopup","lat","toFixed","lng","openPopup","isOpen","remove","popupContent","setLatLng","setContent","openOn","button","document","getElementById","buttonClickHandler","off","style","padding","backgroundColor","minHeight","children","ref","id","height","width","borderRadius","boxShadow","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/daliborseckar/cityStep/src/components/map.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n    iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\n    iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\n    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',\n});\n\n\nfunction Map() {\n    const mapContainerRef = useRef(null);\n\n    const mapInstanceRef = useRef(null);\n\n    useEffect(() => {\n        if (mapContainerRef.current && !mapInstanceRef.current) {\n\n            const map = L.map(mapContainerRef.current).setView([51.505, -0.09], 13);\n            mapInstanceRef.current = map;\n\n            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n                maxZoom: 19,\n                attribution: '© OpenStreetMap contributors'\n            }).addTo(map);\n\nmap.on('contextmenu', function(e){\n                L.DomEvent.preventDefault(e); \n                const latlng = e.latlng;\n\n                const popup = L.popup() // Define 'popup' before the handler\n\n                const confirmLocationHandler = () => {\n                    // map.closePopup(); // ❌ Removed: It triggers the 'remove' cleanup before the listener can execute the rest of its code.\n\n                    L.marker(latlng).addTo(map)\n                        .bindPopup(\"New Marker Added at: \" + latlng.lat.toFixed(4) + \", \" + latlng.lng.toFixed(4))\n                        .openPopup();\n                    \n                    // ✅ Now close the context menu popup. This will trigger the 'remove' cleanup, \n                    // but the marker is already added and the new popup is open.\n                    if (popup.isOpen()) {\n                        popup.remove(); \n                    }\n                };\n\n                const popupContent = `\n                    <div style=\"text-align: center; padding: 5px;\">\n                        <p style=\"font-weight: 600; margin-bottom: 10px;\">Add a new location marker here?</p>\n                        <button id=\"add-marker-btn\" \n                                style=\"padding: 8px 15px; cursor: pointer; background-color: #0078A8; color: white; border: none; border-radius: 4px; font-size: 14px; transition: background-color 0.2s;\">\n                            Confirm Location\n                        </button>\n                    </div>\n                `;\n\n                popup\n                    .setLatLng(latlng)\n                    .setContent(popupContent)\n                    .openOn(map); // Open the context menu popup\n\n                popup.on('open', function() {\n                    const button = document.getElementById('add-marker-btn');\n                    \n                    if (button) {\n                        L.DomEvent.on(button, 'click', confirmLocationHandler);\n                        popup.buttonClickHandler = confirmLocationHandler; // Store reference for cleanup\n                    }\n                });\n\n                popup.on('remove', function() {\n                    // This cleanup is good and necessary to prevent memory leaks!\n                    const button = document.getElementById('add-marker-btn');\n                    if (button && popup.buttonClickHandler) {\n                        L.DomEvent.off(button, 'click', popup.buttonClickHandler);\n                        popup.buttonClickHandler = null; \n                    }\n                });\n            });\n\n            return () => {\n                map.remove();\n                mapInstanceRef.current = null;\n            };\n        }\n    }, []);\n\n    return (\n        <div style={{ padding: '20px', backgroundColor: '#f4f7f9', minHeight: '100vh' }}>\n            <div \n                ref={mapContainerRef} \n                id=\"map\" \n                style={{ height: '70vh', width: '100%', borderRadius: '8px', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}\n            />\n        </div>\n    );\n}\n\nexport default Map;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAChD,OAAOC,CAAC,MAAM,SAAS;AACvB,OAAO,0BAA0B;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAElC,OAAOF,CAAC,CAACG,IAAI,CAACC,OAAO,CAACC,SAAS,CAACC,WAAW;AAC3CN,CAAC,CAACG,IAAI,CAACC,OAAO,CAACG,YAAY,CAAC;EACxBC,aAAa,EAAE,gEAAgE;EAC/EC,OAAO,EAAE,6DAA6D;EACtEC,SAAS,EAAE;AACf,CAAC,CAAC;AAGF,SAASC,GAAGA,CAAA,EAAG;EAAAC,EAAA;EACX,MAAMC,eAAe,GAAGd,MAAM,CAAC,IAAI,CAAC;EAEpC,MAAMe,cAAc,GAAGf,MAAM,CAAC,IAAI,CAAC;EAEnCD,SAAS,CAAC,MAAM;IACZ,IAAIe,eAAe,CAACE,OAAO,IAAI,CAACD,cAAc,CAACC,OAAO,EAAE;MAEpD,MAAMC,GAAG,GAAGhB,CAAC,CAACgB,GAAG,CAACH,eAAe,CAACE,OAAO,CAAC,CAACE,OAAO,CAAC,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;MACvEH,cAAc,CAACC,OAAO,GAAGC,GAAG;MAE5BhB,CAAC,CAACkB,SAAS,CAAC,gDAAgD,EAAE;QAC1DC,OAAO,EAAE,EAAE;QACXC,WAAW,EAAE;MACjB,CAAC,CAAC,CAACC,KAAK,CAACL,GAAG,CAAC;MAEzBA,GAAG,CAACM,EAAE,CAAC,aAAa,EAAE,UAASC,CAAC,EAAC;QACjBvB,CAAC,CAACwB,QAAQ,CAACC,cAAc,CAACF,CAAC,CAAC;QAC5B,MAAMG,MAAM,GAAGH,CAAC,CAACG,MAAM;QAEvB,MAAMC,KAAK,GAAG3B,CAAC,CAAC2B,KAAK,CAAC,CAAC,EAAC;;QAExB,MAAMC,sBAAsB,GAAGA,CAAA,KAAM;UACjC;;UAEA5B,CAAC,CAAC6B,MAAM,CAACH,MAAM,CAAC,CAACL,KAAK,CAACL,GAAG,CAAC,CACtBc,SAAS,CAAC,uBAAuB,GAAGJ,MAAM,CAACK,GAAG,CAACC,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,GAAGN,MAAM,CAACO,GAAG,CAACD,OAAO,CAAC,CAAC,CAAC,CAAC,CACzFE,SAAS,CAAC,CAAC;;UAEhB;UACA;UACA,IAAIP,KAAK,CAACQ,MAAM,CAAC,CAAC,EAAE;YAChBR,KAAK,CAACS,MAAM,CAAC,CAAC;UAClB;QACJ,CAAC;QAED,MAAMC,YAAY,GAAG;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;QAEDV,KAAK,CACAW,SAAS,CAACZ,MAAM,CAAC,CACjBa,UAAU,CAACF,YAAY,CAAC,CACxBG,MAAM,CAACxB,GAAG,CAAC,CAAC,CAAC;;QAElBW,KAAK,CAACL,EAAE,CAAC,MAAM,EAAE,YAAW;UACxB,MAAMmB,MAAM,GAAGC,QAAQ,CAACC,cAAc,CAAC,gBAAgB,CAAC;UAExD,IAAIF,MAAM,EAAE;YACRzC,CAAC,CAACwB,QAAQ,CAACF,EAAE,CAACmB,MAAM,EAAE,OAAO,EAAEb,sBAAsB,CAAC;YACtDD,KAAK,CAACiB,kBAAkB,GAAGhB,sBAAsB,CAAC,CAAC;UACvD;QACJ,CAAC,CAAC;QAEFD,KAAK,CAACL,EAAE,CAAC,QAAQ,EAAE,YAAW;UAC1B;UACA,MAAMmB,MAAM,GAAGC,QAAQ,CAACC,cAAc,CAAC,gBAAgB,CAAC;UACxD,IAAIF,MAAM,IAAId,KAAK,CAACiB,kBAAkB,EAAE;YACpC5C,CAAC,CAACwB,QAAQ,CAACqB,GAAG,CAACJ,MAAM,EAAE,OAAO,EAAEd,KAAK,CAACiB,kBAAkB,CAAC;YACzDjB,KAAK,CAACiB,kBAAkB,GAAG,IAAI;UACnC;QACJ,CAAC,CAAC;MACN,CAAC,CAAC;MAEF,OAAO,MAAM;QACT5B,GAAG,CAACoB,MAAM,CAAC,CAAC;QACZtB,cAAc,CAACC,OAAO,GAAG,IAAI;MACjC,CAAC;IACL;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,oBACIb,OAAA;IAAK4C,KAAK,EAAE;MAAEC,OAAO,EAAE,MAAM;MAAEC,eAAe,EAAE,SAAS;MAAEC,SAAS,EAAE;IAAQ,CAAE;IAAAC,QAAA,eAC5EhD,OAAA;MACIiD,GAAG,EAAEtC,eAAgB;MACrBuC,EAAE,EAAC,KAAK;MACRN,KAAK,EAAE;QAAEO,MAAM,EAAE,MAAM;QAAEC,KAAK,EAAE,MAAM;QAAEC,YAAY,EAAE,KAAK;QAAEC,SAAS,EAAE;MAA6B;IAAE;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC1G;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAEd;AAAChD,EAAA,CAtFQD,GAAG;AAAAkD,EAAA,GAAHlD,GAAG;AAwFZ,eAAeA,GAAG;AAAC,IAAAkD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}